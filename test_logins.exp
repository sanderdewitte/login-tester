#!/usr/bin/expect -f

log_user 0 ;# Disable all automatic output from spawn
set timeout 5

# User/password pairs to test
set users {
  {user1 verysecret123}
  {user2 verysecret456}
}

foreach userpass $users {
  lassign $userpass username password
  puts "ğŸ” Testing login for user: $username"

  # Capture just result, silence the rest
  spawn login $username

  expect {
    "Password:" {
      send "$password\r"
      expect {
        -re {\r\n[^#\$]*[#\$] $} {
          puts "âœ… Login succeeded for $username"
          send "exit\r"
        }
        "Login incorrect" {
          puts "âŒ Login failed for $username"
        }
        timeout {
          puts "â±ï¸ Timeout after entering password for $username"
        }
      }
    }
    "Login incorrect" {
      puts "âŒ Immediate login failure for $username"
    }
    timeout {
      puts "â±ï¸ Timeout before password prompt for $username"
    }
  }

  expect eof
}

